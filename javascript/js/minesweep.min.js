var gridSize=20,grid=gridSize*gridSize,tileSize=20,border=3,maxMines=45,bombs=[],board=document.getElementById("mineboard"),alltiles=board.getElementsByTagName("p");function gameManager(){boardSettings();generateBomb();drawGrid()}gameManager();function setAttrs(a,b){for(var c in b)a.setAttribute(c,b[c])}function setStyles(a,b){for(var c in b)a.style[c]=b[c]}function removeItems(a,b){b.forEach(function(b){-1<a.indexOf(b)&&a.splice(a.indexOf(b),1)})}
function shuffleArray(a){for(var b=0;b<a.length;b++){var c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c];a[c]=d}return a}function boardSettings(){board.innerHTML=null;setStyles(board,{width:gridSize*(tileSize+2*border)+"px",height:gridSize*(tileSize+2*border)+"px"})}
function createTile(a,b){var c=document.createElement("p");setStyles(c,{width:tileSize+"px",height:tileSize+"px","border-width":border+"px","line-height":tileSize+"px"});setAttrs(c,{bomb:a,numb:b});c.onclick=function(a){primaryCheck(a.target);update()};c.oncontextmenu=function(a){a.preventDefault();markFlag(a.target);return!1};board.appendChild(c)}function drawGrid(){for(var a=0;a<grid;a++)createTile(bombs[a],a)}
function generateBomb(){for(var a=0;a<grid;a++)bombs.push(0),a<maxMines&&(bombs[a]=1);shuffleArray(bombs)}function bombHit(a){for(var b=0;b<bombs.length;b++)1===bombs[b]&&setAttrs(alltiles[b],{checked:"true"}),setAttrs(a,{explode:"true"})}function getBombs(a){var b=0,c;for(c in a)var d=alltiles[a[c]].getAttribute("bomb"),b=b+parseInt(d,10);return b}function markFlag(a){"1"==a.getAttribute("flag")?a.setAttribute("flag","0"):a.setAttribute("flag","1")}
function markChecked(a,b){setAttrs(a,{checked:"true"});0!=b&&(a.textContent=b)}
function tertiaryCheck(a,b,c){if(!a.hasAttribute("checked")){var d=[];c.forEach(function(a){switch(a){case "tl":d.push(b-(gridSize+1));break;case "tm":d.push(b-gridSize);break;case "tr":d.push(b-(gridSize-1));break;case "ml":d.push(b-1);break;case "mr":d.push(b+1);break;case "ll":d.push(b+(gridSize-1));break;case "lm":d.push(b+gridSize);break;case "lr":d.push(b+(gridSize+1))}});markChecked(a,getBombs(d));a.textContent||d.forEach(function(a){tertiaryCheck(alltiles[a],a,checkRound(alltiles[a]))})}}
function checkRound(a){if(!a.hasAttribute("checked")){var b=parseInt(a.getAttribute("numb"),10),c="tl tm tr ml mr ll lm lr".split(" ");b<gridSize&&removeItems(c,["tl","tm","tr"]);0===b%gridSize&&removeItems(c,["tl","ml","ll"]);0===(b+1)%gridSize&&removeItems(c,["tr","mr","lr"]);b>=grid-gridSize&&removeItems(c,["ll","lm","lr"]);tertiaryCheck(a,b,c)}}function primaryCheck(a){a.hasAttribute("checked")||("1"==a.getAttribute("bomb")?(bombHit(a),gameLose()):checkRound(a))}
function disableMouse(){for(var a=0;a<grid;a++)alltiles[a].onclick=null,alltiles[a].oncontextmenu=function(a){a.preventDefault()}}function update(){for(var a=[],b=0;b<grid;b++)alltiles[b].hasAttribute("checked")?a.push(0):a.push(1);a.toString()==bombs.toString()&&gameWin()}function gameWin(){console.log("YOU WIN");disableMouse()}function gameLose(){disableMouse()};
