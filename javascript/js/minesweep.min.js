var e=[],f=document.getElementById("mineboard"),g=f.getElementsByTagName("p");h(f,{width:"520px",height:"520px"});for(var k=0;400>k;k++)e.push(0),20>k&&(e[k]=1);for(var l=0;l<e.length;l++){var m=Math.floor(Math.random()*(l+1)),n=e[l];e[l]=e[m];e[m]=n}for(var p=0;400>p;p++)q();function r(b,a){for(var c in a)b.setAttribute(c,a[c])}function h(b,a){for(var c in a)b.style[c]=a[c]}function s(b,a){a.forEach(function(a){-1<b.indexOf(a)&&b.splice(b.indexOf(a),1)})}
function q(){var b=e[p],a=p,c=document.createElement("p");h(c,{width:"20px",height:"20px","border-width":"3px","line-height":"20px"});r(c,{bomb:b,numb:a});c.onclick=function(a){a=a.target;if(!a.hasAttribute("checked"))if("1"==a.getAttribute("bomb")){for(var b=0;b<e.length;b++)1===e[b]&&r(g[b],{checked:"true"}),r(a,{explode:"true"});t()}else u(a);a=[];for(b=0;400>b;b++)g[b].hasAttribute("checked")?a.push(0):a.push(1);a.toString()==e.toString()&&(console.log("YOU WIN"),t())};c.oncontextmenu=function(a){a.preventDefault();
a=a.target;"1"==a.getAttribute("flag")?a.setAttribute("flag","0"):a.setAttribute("flag","1");return!1};f.appendChild(c)}function v(b){var a=0,c;for(c in b)var d=g[b[c]].getAttribute("bomb"),a=a+parseInt(d,10);return a}function w(b,a){r(b,{checked:"true"});0!=a&&(b.textContent=a)}
function x(b,a,c){if(!b.hasAttribute("checked")){var d=[];c.forEach(function(b){switch(b){case "tl":d.push(a-21);break;case "tm":d.push(a-20);break;case "tr":d.push(a-19);break;case "ml":d.push(a-1);break;case "mr":d.push(a+1);break;case "ll":d.push(a+19);break;case "lm":d.push(a+20);break;case "lr":d.push(a+21)}});w(b,v(d));b.textContent||d.forEach(function(a){x(g[a],a,u(g[a]))})}}
function u(b){if(!b.hasAttribute("checked")){var a=parseInt(b.getAttribute("numb"),10),c="tl tm tr ml mr ll lm lr".split(" ");20>a&&s(c,["tl","tm","tr"]);0===a%20&&s(c,["tl","ml","ll"]);0===(a+1)%20&&s(c,["tr","mr","lr"]);380<=a&&s(c,["ll","lm","lr"]);x(b,a,c)}}function t(){for(var b=0;400>b;b++)g[b].onclick=null,g[b].oncontextmenu=function(a){a.preventDefault()}};
